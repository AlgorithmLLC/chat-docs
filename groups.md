### Работа c группами

Данный документ описывает логику и сценарий работы по управлению группами.

1. [Создание группы](/groups.md#Создание-группы)
2. [Просмотр группы](/groups.md#Просмотр-группы)
3. [Редактирование группы](/groups.md#Редактирование-группы)

#### Создание группы

Для создания группы необходимо отправить следующий фрейм [`new group`](/socket.io/client-emited/group/new group.md).
В пользовательском интерфесе получение необходимых данных для создания группы происходит в два этапа.

1. После нажати на иконку создания группы открывается следующий экран:
<br /><img src=/blob/groups/1group_create.png width=250  /><br />
На этом экране опционально можно установить аватар будущей группы. Обязательно необходимо указать название будущей группы.
После нажатия на кнопку далее переход на следующий экран.
2. Экран выбора участников группы:
<br /><img src=/blob/groups/2group_create.png width=250  /><br />
На это экране задается список участников группы. После нажатия кнопки далее создается новая группа [`new group`](/socket.io/client-emited/group/new group.md). Далее необходимо создать первый диалог.
В новый диалог необходимо добавить сообщение с разным текстом для создавшего группу и для остальных участников. Сообщения:
  - Администратор: _'Создана новая группа. Этот диалог создан автоматически.'_
  - Остальные участники: _'Вы добавлены в новую группу. Это самое начало переписки.'_


#### Просмотр группы

Для просмотра информации о группе необходимо перейти в карточку группы, тапнув на заголовок на экране с перепиской.

Вид карточки для администратора группы:

1. Основной экран
<br /><img src=/blob/groups/1groupadmin_card.png width=250  />
2. Редактирование названия
<br /><img src=/blob/groups/2groupadmin_theme.png width=250  />
3. Меню просмотра аватара
<br /><img src=/blob/groups/3groupadmin_avatar.png width=250  />
4. Меню участника группы
<br /><img src=/blob/groups/4groupadmin_avatarmenu.png width=250  />
5. Добавление участника группы
<br /><img src=/blob/groups/5groupadmin_usermenu.png width=250  />

Вид карточки для остальных участников

1. Основной экран
<br /><img src=/blob/groups/6group_card.png width=250  />
2. Просмотр аватара
<br /><img src=/blob/groups/7group_menu.png width=250  />
3. Просмотр аватара
<br /><img src=/blob/groups/8group_avatar.png width=250  />

#### Редактирование группы

Редактирование группы происходит из карточки группы.

1. Изменение аватара
[`change avatar`](/socket.io/client-emited/group/change avatar.md)
2. Изменение названия группы | добавление участников | исключение участников
[`edit group`](/socket.io/client-emited/group/edit group.md).

При изменении группы стоит обратить внимание на следующее:

1. Перешифрование имен диалогов. При изменении числа участнико группы необходимо обновить набор Bodies для каждого диалога в группе, чтобы сохранить согласованность данных и чтобы каждый из участников смог расшифровать названия диалогов.
2. Отметка о прочтении сообщений. Каждое создаваемое сервисное сообщение дублируется в каждый диалог в группе. Необходимо сделать так, чтобы непрочитанными были сообщения, отправляемые только в диалог с самой свежей перепиской. Для этого у каждого создаваемого сервисного сообщения предусмотрено поле `as_read`. Для администратора группы все сообщения автоматически отмечаются как прочтенные. Для остальных собеседников необходимо установить `as_read = true` для всех диалогов, кроме самого свежего. Чтобы получить самый свежий диалог, нужно определить в каком из диалогов в группе находится сообщение с самой новой датой.

